- # locals:
- page || raise('no page given')
- teaser_box ||= false
- raise('Please use the pages/teaser_box partial instead!') if teaser_box

.page_with_attachments
  %h1.page{id: "page-#{page.id}-box"}
    - if (page.try(:becomes, Page) == @navable.try(:becomes, Page)) and not @this_is_a_new_blog_post
      -#= best_in_place_if can?(:update, page), page, :title
      = wysiwyg_in_place_if can?(:update, page), page, :title
    - elsif page.kind_of? Pages::ContentBox
      = best_in_place_if can?(:update, page), page, :title
    - else  # Blog Entries:
      = link_to(page) do
        = best_in_place_if can?(:update, page), page, :title, class: 'click_does_not_trigger_edit', activator: 'only_manual'
    = render partial: 'pages/box_tool_buttons', object: page, as: :page
  %div.page
    - if page.image_attachments_not_listed_in_content.any?
      #inline-pictures= render partial: 'attachments/pictures', locals: {attachments: page.image_attachments_not_listed_in_content, inline: true}

    = render partial: 'pages/meta', object: page, as: :page

    - if page.kind_of? BlogPost
      .page_teaser{class: ('show_only_in_edit_mode' if page.content.try(:include?, page.teaser_text.to_s))}
        = best_in_place_if can?(:update, page), page, :teaser_text, as: :textarea, activator: 'manual'

    = render partial: 'pages/page_body', object: page, as: :page

    - if not @blog_entries.present? and not @hide_attachment_drop_fields and can?(:create_attachment_for, page)
      .hidden-print.show_only_in_edit_mode
        #attachments= render partial: 'attachments/drop_field', locals: {parent: page}

  #attachments.attachments
    = render(partial: 'pages/videos', locals: {page: page})
    = render(partial: 'pages/attachments', locals: {page: page, show_drop_field: true})
